@startuml class-diagram
skinparam classAttributeIconSize 0

class User {
  +userId: UUID
  +email: String
  +passwordHash: String
  +createdAt: DateTime
}

class UserProfile {
  +profileId: UUID
  +name: String
  +dob: Date
  +heightCm: int
  +weightKg: float
}

class MedicalProfile {
  +medicalProfileId: UUID
  +diabetes: boolean
  +notes: String
}

class Allergy {
  +allergyId: UUID
  +name: String
  +severity: String
}

class DietaryGoal {
  +goalId: UUID
  +goalType: String  // weight_loss, maintenance, etc.
  +targetCalories: int
  +dietStyle: String // keto, vegan, etc.
  +startDate: Date
}

class MealLog {
  +mealLogId: UUID
  +loggedAt: DateTime
  +mealType: String // breakfast, lunch...
  +source: String   // photo/manual
}

class MealImage {
  +imageId: UUID
  +uri: String
  +uploadedAt: DateTime
}

class MealAnalysis {
  +analysisId: UUID
  +confidence: float
  +status: String  // pending/complete/failed
}

class Ingredient {
  +ingredientId: UUID
  +name: String
  +quantity: String
}

class NutritionFacts {
  +nutritionId: UUID
  +calories: int
  +proteinG: float
  +carbsG: float
  +fatG: float
  +sodiumMg: float
  +sugarG: float
}

class Recommendation {
  +recommendationId: UUID
  +type: String // substitution, portion, warning
  +message: String
  +priority: int
}

class Recipe {
  +recipeId: UUID
  +title: String
  +instructions: Text
}

class GroceryList {
  +groceryListId: UUID
  +createdAt: DateTime
}

class GroceryItem {
  +groceryItemId: UUID
  +name: String
  +quantity: String
  +isChecked: boolean
}

' --- Service layer (logical classes) ---
class AuthService {
  +register()
  +login()
  +validateToken()
}
class MealAnalysisService {
  +submitImage()
  +runVision()
  +persistAnalysis()
}
class NutritionService {
  +lookupNutrition()
  +computeTotals()
}
class RecommendationService {
  +generateSuggestions()
  +checkMedicalConstraints()
}
class MealLogService {
  +createLog()
  +attachAnalysis()
  +getHistory()
}
class RecipeService {
  +saveRecipe()
  +getRecipes()
}
class GroceryService {
  +generateList()
}

' --- Relationships ---
User "1" -- "1" UserProfile
User "1" -- "1" MedicalProfile
MedicalProfile "1" -- "*" Allergy
User "1" -- "*" DietaryGoal
User "1" -- "*" MealLog
MealLog "0..1" -- "1" MealImage
MealLog "0..1" -- "1" MealAnalysis
MealAnalysis "1" -- "*" Ingredient
MealAnalysis "1" -- "1" NutritionFacts
MealAnalysis "1" -- "*" Recommendation

User "1" -- "*" Recipe
User "1" -- "*" GroceryList
GroceryList "1" -- "*" GroceryItem

' --- Dependencies (services use domain) ---
AuthService ..> User
MealAnalysisService ..> MealImage
MealAnalysisService ..> MealAnalysis
NutritionService ..> NutritionFacts
RecommendationService ..> Recommendation
RecommendationService ..> MedicalProfile
MealLogService ..> MealLog
RecipeService ..> Recipe
GroceryService ..> GroceryList

@enduml
